@import services.rules.PathRule
@import services.users.User
@(user: Option[User], rules: List[PathRule], users: List[User])

@main("Authentication") {
  <h1>Welcome to AuthThingie!</h1>

  @if(user.isEmpty) {
    <div class="row align-items-start">
      <div class="col">
        <h2>Not logged in</h2>
        <a class="btn btn-primary" href="/login">Click here to login</a>
      </div>

    </div>
  } else {
    <div class="row align-items-start">
      <div class="col col-md-5 col-sm-8">
        <h2>Logged in as @user.get.username</h2>
      </div>
      <div class="col col-4">
        <h3><a class="btn btn-danger" href="/logout">Click here to logout</a></h3>
      </div>
    </div>

    @if(users.nonEmpty) {
      <div class="table-responsive">
        <table class="table table-striped table-sm user-table">
          <caption>List of Users</caption>
          <thead>
            <tr>
              <th scope="col">Username</th>
              <th scope="col">Is Admin?</th>
              <th scope="col">Uses TOTP?</th>
              <th scope="col">Roles</th>
            </tr>
          </thead>
          <tbody>
            @for(user <- users) {
              <tr>
                <td>
                @user.username
                </td>
                <td>
                @user.admin.toString
                </td>
                <td>
                @user.usesTotp
                </td>
                <td>
                @user.roles.mkString("[", ", ", "]")
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    @if(rules.nonEmpty) {
      <div class="table-responsive">
        <table class="table table-striped table-sm rule-table">
          <caption>List of Rules</caption>
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Protocol</th>
              <th scope="col">Host</th>
              <th scope="col">Path</th>
              <th scope="col">Public?</th>
              <th scope="col">Permitted Roles</th>
            </tr>
          </thead>
          <tbody>
            @for(rule <- rules) {
              <tr>
                <td>
                @rule.name
                </td>
                <td>
                @rule.protocolPattern.getOrElse("*")
                </td>
                <td>
                @rule.hostPattern.getOrElse("*")
                </td>
                <td>
                @rule.pathPattern.getOrElse("*")
                </td>
                <td>
                @rule.public.toString
                </td>
                <td>
                @rule.permittedRoles.mkString("[", ", ", "]")
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- <h4>Rule Tester</h4>
      <label for="url_to_test">URL to test: </label><input type="text" id="url_to_test" />
      <button>Test it!</button> -->
    }

  }
}
